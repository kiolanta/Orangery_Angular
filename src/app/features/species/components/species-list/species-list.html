<div class="species-container">
  <div class="page-header">
    <div>
      <h1>–í–∏–¥–∏ —Ä–æ—Å–ª–∏–Ω</h1>
      <p class="subtitle">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤–∏–¥–∞–º–∏ —Ä–æ—Å–ª–∏–Ω</p>
    </div>
    <button class="btn-add" (click)="openAddForm()">
      <span class="btn-icon">+</span>
      –î–æ–¥–∞—Ç–∏ –≤–∏–¥
    </button>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
  </div>

  <div *ngIf="error && !loading" class="error-card">
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="loadSpecies()">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
  </div>

  <div *ngIf="!loading && !error && species.length === 0" class="no-data">
    <div class="no-data-icon">üå±</div>
    <p>–í–∏–¥—ñ–≤ —Ä–æ—Å–ª–∏–Ω –ø–æ–∫–∏ –Ω–µ–º–∞—î</p>
    <button class="btn-add-first" (click)="openAddForm()">–î–æ–¥–∞—Ç–∏ –ø–µ—Ä—à–∏–π –≤–∏–¥</button>
  </div>

  <div *ngIf="!loading && !error && species.length > 0" class="table-card">
    <table class="species-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>–ù–∞–∑–≤–∞ –≤–∏–¥—É</th>
          <th>–î—ñ—ó</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of species" class="row-main" (click)="openCareModal(item)" style="cursor: pointer;">
          <td>
            <span class="id-badge">#{{ item.id }}</span>
          </td>
          <td><strong>{{ item.name }}</strong></td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon-action btn-edit" (click)="openEditForm(item); $event.stopPropagation();" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">
                ‚úèÔ∏è
              </button>
              <button class="btn-icon-action btn-delete" (click)="deleteSpecies(item.id); $event.stopPropagation();" title="–í–∏–¥–∞–ª–∏—Ç–∏">
                üóëÔ∏è
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ –¥–µ—Ç–∞–ª—è–º–∏ –¥–æ–≥–ª—è–¥—É -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>–î–µ—Ç–∞–ª—ñ –¥–æ–≥–ª—è–¥—É –∑–∞ –≤–∏–¥–æ–º</h2>
      <button class="modal-close" (click)="closeModal()">‚úï</button>
    </div>

    <div class="modal-body">
      <div *ngIf="selectedSpeciesForDetail" class="species-detail">
        <h3>{{ selectedSpeciesForDetail.name }}</h3>
        
        <div *ngIf="!careGuidesLoading; else careLoadingTpl" class="care-details">
          <ng-container *ngIf="getCareGuideBySpecies(selectedSpeciesForDetail.id) as cg; else noCareTpl">
            <div class="care-detail-table">
              <div class="detail-row">
                <span class="detail-label">“ê—Ä—É–Ω—Ç</span>
                <span class="detail-value">{{ cg.soilType || '‚Äî' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">–î–æ–±—Ä–∏–≤–æ</span>
                <span class="detail-value">{{ cg.fertilizerType || '‚Äî' }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">–ü–æ–ª–∏–≤</span>
                <span class="detail-value">{{ cg.wateringFrequency || '‚Äî' }}</span>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-close-modal" (click)="closeModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
  </div>
</div>

<app-species-form
  *ngIf="showForm"
  [species]="editingSpecies"
  (formSubmit)="onSubmit($event)"
  (formCancel)="closeForm()"
></app-species-form>

<ng-template #careLoadingTpl>
  <div class="care-loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—ñ–¥–∞ –¥–æ–≥–ª—è–¥—É...</div>
</ng-template>

<ng-template #noCareTpl>
  <div class="care-empty">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –¥–æ–≥–ª—è–¥ –¥–ª—è —Ü—å–æ–≥–æ –≤–∏–¥—É</div>
</ng-template>

